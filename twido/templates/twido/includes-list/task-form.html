{# Task detail AJAX form #}
{# vars: thetask - current task to display #}
{% load i18n %}
<!-- BEGIN task detail setting -->
                            <form class="form-horizontal" method="post" action="{{ request.path }}">
                                {% csrf_token %}
                                <fieldset>
                                    <legend>{{ thetask.title }}</legend>

                                    <!-- name -->
                                    <div class="form-group">
                                        <label for="title" class="col-lg-2 col-md-2 control-label">{% trans 'Task Title' %}</label>

                                        <div class="col-lg-10 col-md-10">
                                            <span id="title" data-type="text" data-pk="{{ thetask.id }}"
                                                  data-url="{{ request.path }}">
                                                {{ thetask.title }}
                                            </span>
                                        </div>
                                    </div>

                                    <!-- status -->
                                    <div class="form-group">
                                        <label for="status" class="col-lg-2 col-md-2 control-label">{% trans 'Status' %}</label>

                                        <div class="col-lg-10 col-md-10">
                                            <span id="status" data-type="select" data-pk="{{ thetask.id }}"
                                                  data-url="{{ request.path }}"><i class="{{ thetask.get_status_glyphicon }}">
                                            </i> {{ thetask.get_status_text }}</span>
{#                                            <span class="help-block">Long description.</span>#}
                                        </div>

                                    </div>

                                    <!-- reminder -->
                                    <div class="form-group">
                                        <label for="reminder" class="col-lg-2 col-md-2 control-label">{% trans 'Deadline' %}</label>

                                        <div class="col-lg-10 col-md-10">
                                            <span id="reminder" data-type="datetime" data-pk="{{ thetask.id }}"
                                                  data-url="{{ request.path }}">{{ thetask.reminder | default_if_none:'' }}</span>
{#                                            <span class="help-block">The time to remind me.</span>#}
                                        </div>
                                    </div>

                                    <!-- labels -->
                                    <div class="form-group">
                                        <label for="labels" class="col-lg-2 col-md-2 control-label">{% trans 'Labels' %}</label>

                                        <div class="col-lg-10 col-md-10">
                                            <span id="labels" data-type="select2" data-pk="{{ thetask.id }}"
                                                  data-url="{{ request.path }}"
                                                  data-value="{{ thetask.labels | default_if_none:'' }}">
                                                {{ thetask.labels | default_if_none:'' }}</span>
                                        </div>
                                    </div>

                                    <!-- long text -->
                                    <div class="form-group">
                                        <label for="text" class="col-lg-2 col-md-2 control-label">{% trans 'Detail Text' %}</label>

                                        <div class="col-lg-10 col-md-10">
                                            <span id="text" data-type="textarea" data-pk="{{ thetask.id }}"
                                                  data-url="{{ request.path }}">{{ thetask.text | default_if_none:'' }}</span>
{#                                            <span class="help-block">Long description.</span>#}
                                        </div>

                                    </div>

                                    <!-- form buttons -->
{#                                    <div class="form-group edit">#}
{#                                        <div class="col-lg-10 col-lg-offset-2">#}
{#                                            <button id="btn-cancel" type="reset" class="btn btn-default">Cancel</button>#}
{#                                            <button id="btn-submit" type="submit" class="btn btn-primary">Submit#}
{#                                            </button>#}
{#                                            <input id="id_list_id" type="hidden" name="id" value="{{ thelist.id }}"/>#}
{#                                        </div>#}
{#                                    </div>#}
                                </fieldset>
                            </form>

                            <script language="JavaScript" type="text/javascript">

                                $('#title').editable({
                                    success: function (response, newValue) {
                                        if (response.status == 'error') return response.msg; //msg will be shown in editable form
                                    }
                                }).on('save', function (e, params) {
                                    $("legend").text(params.newValue);
                                    var menu = $('.list-group').find('a.active').find('li');
                                    if (menu.length)
                                        menu.first().next().text(params.newValue);
                                });

                                $('#status').editable({
                                    escape: false,
                                    source: [
                                        {% for value, text in taskstatus.Choices %}
                                            {value: {{ value }}, text: "{{ text }}"},
                                        {% endfor %}
                                    ],
                                    display: function (value, resp) {
                                        {# Do nothing. Keep for icon display rendering #}
                                    },
                                    success: function (response, newValue) {
                                        if (response.status == 'error')
                                            return response.msg; //msg will be shown in editable form
                                    }
                                }).on('save', function (e, params) {
                                    $(this).html('<i class="' + params.response.status_icon_class + '"></i> '
                                        + params.response.status_text);
                                    var menu = $('.list-group').find('.active').find('li');
                                    if (menu.length)
                                        menu.first().html('<i class="' + params.response.status_icon_class + '"></i>');
                                });

                                $('#labels').editable({
                                    showbuttons: 'true',
                                    select2: {
                                        width: '200px',
                                        tags: 'true',
                                        allowClear: 'true',
                                        placeholder: 'enter labels',
                                        multiple: 'true',
                                        minimumInputLength: 2,
                                        delay: 250,
                                        initSelection: function (option, callback) {
                                            var origin = option.closest("span").parent().find("#labels").children();
                                            var data = [];
                                            $(origin).each(function () {
                                                var t = $(this).text();
                                                data.push({
                                                    id: t,
                                                    text: t
                                                });
                                            });
                                            callback(data);
                                        }
                                    },
                                    display: function (value, resp) {
                                        var target = $(this).closest("div").find("#labels");
                                        if (value && value.length) {
                                            var values = value.toString().split(',');
                                            var html = '';
                                            $(values).each(function () {
                                                html += '<span class="label label-default">' + this + '</span> ';
                                            });
                                            target.html(html);
                                        } else {
{#                                            target.html('<span class="label label-default">...</span>');#}
                                            target.html('<i class="glyphicon glyphicon-tags"></i>');
                                        }
                                    },
                                    success: function (response, newValue) {
                                        if (response.status == 'error') return response.msg; //msg will be shown in editable form
                                    }
                                });

                                $('#reminder').editable({
                                    mode: 'popup',
                                    placement: 'right',
                                    allowClear: 'true',
                                    onblur: 'cancel',
                                    {#                format: 'yyyy-mm-dd hh:ii',#}
                                    {#                viewformat: 'dd/mm/yyyy hh:ii',#}
                                    datetimepicker: {
                                        weekStart: 1
                                    },
                                    success: function (response, newValue) {
                                        if (response.status == 'error') return response.msg; //msg will be shown in editable form
                                    }
                                });

                                $('#text').editable({
                                    rows: 4,
                                    tpl: "<textarea style='width: 400px'></textarea>",
                                    success: function (response, newValue) {
                                        if (response.status == 'error') return response.msg; //msg will be shown in editable form
                                    }
                                });

                            </script>
<!-- END task detail form -->